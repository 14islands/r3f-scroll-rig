import e,{useMemo as t,useEffect as r,forwardRef as i,useRef as n}from"react";import{Color as l,Vector2 as o}from"three";import{useThree as a,useFrame as u}from"@react-three/fiber";import{Text as c}from"@react-three/drei";import{useScrollRig as s,useScrollbar as f,useImageAsTexture as p,ScrollScene as v}from"@14islands/r3f-scroll-rig";function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},h.apply(this,arguments)}function m(e,t){if(null==e)return{};var r,i,n={},l=Object.keys(e);for(i=0;i<l.length;i++)t.indexOf(r=l[i])>=0||(n[r]=e[r]);return n}var d=["el","children","material","scale","font","fontOffsetY","fontOffsetX","overrideEmissive","color"],g=function(i){var n=i.el,o=i.children,u=i.material,f=i.scale,p=i.font,v=i.fontOffsetY,g=void 0===v?0:v,S=i.fontOffsetX,w=void 0===S?0:S,y=i.overrideEmissive,_=void 0!==y&&y,x=i.color,k=m(i,d),E=a().size,z=s().scaleMultiplier,b=t(function(){if(!n.current)return{};var e=window.getComputedStyle(n.current);return{letterSpacing:(parseFloat(e.letterSpacing)||0)/parseFloat(e.fontSize),lineHeight:(parseFloat(e.lineHeight)||0)/parseFloat(e.fontSize),textColor:new l(x||e.color).convertSRGBToLinear(),fontSize:parseFloat(e.fontSize)*z,textAlign:e.textAlign}},[n,E,f,x,z]),F=b.textColor,O=b.fontSize,L=b.textAlign,M=b.lineHeight,V=b.letterSpacing;r(function(){u&&_&&(u.emissive=x)},[u,x,_]);var j=0;return"left"===L||"start"===L?j=-.5*f[0]:"right"!==L&&"end"!==L||(j=.5*f[0]),e.createElement(c,h({fontSize:O,maxWidth:f?f[0]:E.width,lineHeight:M,textAlign:L,letterSpacing:V,overflowWrap:"break-word",font:p,color:F,anchorX:L,anchorY:"top",position:[j+O*w,(f?.5*f[1]:.5*E.height)+O*g,0],material:u},k),o)},S=["el","scale","scrollState","vertexShader","fragmentShader","invalidateFrameLoop","widthSegments","heightSegments"],w=i(function(i,c){var v=i.el,d=i.scale,g=i.scrollState,w=i.vertexShader,y=i.fragmentShader,_=i.invalidateFrameLoop,x=void 0!==_&&_,k=i.widthSegments,E=void 0===k?128:k,z=i.heightSegments,b=void 0===z?128:z,F=m(i,S),O=n(null),L=n(null),M=a(),V=M.invalidate,j=M.gl,A=M.size,C=a(function(e){return e.viewport.dpr}),H=f().scroll,B=s().scaleMultiplier,T=p(v),X=t(function(){return{u_color:{value:new l("black")},u_time:{value:0},u_pixelRatio:{value:C},u_progress:{value:0},u_visibility:{value:0},u_viewport:{value:0},u_velocity:{value:0},u_res:{value:new o},u_rect:{value:new o},u_size:{value:new o},u_texture:{value:null},u_loaded:{value:!1},u_scaleMultiplier:{value:B}}},[C]);r(function(){T&&O.current&&(O.current.uniforms.u_texture.value=T,O.current.uniforms.u_size.value.set(T.image.width,T.image.height),O.current.uniforms.u_loaded.value=!0)},[T,j]),r(function(){O.current&&(O.current.uniforms.u_res.value.set(A.width,A.height),O.current.uniforms.u_rect.value.set(null==d?void 0:d[0],null==d?void 0:d[1]))},[A,d]),u(function(e,t){g.inViewport&&L.current&&O.current&&O.current.uniforms.u_loaded.value&&(O.current.uniforms.u_time.value+=t,O.current.uniforms.u_rect.value.set(L.current.scale.x,L.current.scale.y),O.current.uniforms.u_velocity.value=H.velocity,O.current.uniforms.u_progress.value=g.progress,O.current.uniforms.u_visibility.value=g.visibility,O.current.uniforms.u_viewport.value=g.viewport,x&&V())});var Y,G=t(function(){return[{vertexShader:w,fragmentShader:y}]},[w,y]);return e.createElement(e.Fragment,null,e.createElement("mesh",h({ref:(Y=[L,c],function(e){Y.forEach(function(t){"function"==typeof t?t(e):null!=t&&(t.current=e)})})},F),e.createElement("planeGeometry",{attach:"geometry",args:[1,1,E,b]}),e.createElement("shaderMaterial",{ref:O,args:G,transparent:!0,uniforms:X})))}),y=["children","speed"],_=function(t){var r=t.children,i=t.scrollState,l=t.parallax,o=n(null),c=a(function(e){return e.size}),f=s().scaleMultiplier;return u(function(){i.inViewport&&(o.current.position.y=l*(2*i.progress-1)*f*c.height)}),e.createElement("mesh",{ref:o},r)},x=function(t){var r=t.children,i=t.speed,n=void 0===i?1:i,l=m(t,y),o=n-1;return e.createElement(v,h({scissor:!1,inViewportMargin:200*Math.max(0,.5)+50+"%"},l),function(t){return e.createElement(_,h({parallax:o},t),r(t))})},k=["scale"],E=["children","track","stickyLerp","fillViewport"],z=function(t){var r=t.children,i=t.childTop,l=t.childBottom,o=t.scrollState,c=t.parentScale,s=t.childScale,f=t.priority,p=t.stickyLerp,v=void 0===p?1:p,h=n(null),m=a(function(e){return e.size});return u(function(e,t){if(o.inViewport){var r=.5*c[1]-.5*s[1];h.current.position.y=function(e,t,r,i,n=60){return l=t,e*(1-(o=void 0===i?r:1-Math.pow(1-r,i/(1/n))))+l*o;var l,o}(h.current.position.y,o.viewport+i/m.height<1?r:o.visibility-l/c[1]<1?-i+r-(o.viewport-1)*m.height:.5*-c[1]+.5*s[1],v,t)}},f),e.createElement("group",{ref:h},r)},b=function(r){var i=r.children,l=r.track,o=r.stickyLerp,u=r.fillViewport,c=m(r,E),s=a(function(e){return e.size}),f=n(l.current),p=t(function(){var e=getComputedStyle(l.current);return"sticky"===e.position?f.current=l.current.parentElement:console.error("StickyScrollScene: tracked element is not position:sticky"),e},[l]);return e.createElement(v,h({track:f},c),function(t,r,i,n){var l=n.stickyLerp,o=n.fillViewport;return function(n){var a=n.scale,u=m(n,k),c=[parseFloat(i.width),parseFloat(i.height),1],s=parseFloat(i.top),f=r.height-s-c[1];return o&&(c=[r.width,r.height,1],s=0,f=0),e.createElement(z,h({parentScale:a,childScale:c,stickyLerp:l,childTop:s,childBottom:f},u),t(h({scale:c},u)))}}(i,s,p,{stickyLerp:o,fillViewport:u}))};export{x as ParallaxScrollScene,b as StickyScrollScene,w as WebGLImage,g as WebGLText};
//# sourceMappingURL=powerups.module.js.map
