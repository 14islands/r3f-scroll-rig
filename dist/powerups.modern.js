import e,{useMemo as t,useEffect as r,forwardRef as i,useRef as l}from"react";import{Color as n,Vector2 as o}from"three";import{useThree as a,useFrame as c}from"@react-three/fiber";import{Text as u}from"@react-three/drei";import{useScrollRig as s,useScrollbar as p,useImageAsTexture as h,ScrollScene as f}from"@14islands/r3f-scroll-rig";function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},m.apply(this,arguments)}function v(e,t){if(null==e)return{};var r,i,l={},n=Object.keys(e);for(i=0;i<n.length;i++)t.indexOf(r=n[i])>=0||(l[r]=e[r]);return l}const d=["el","children","material","scale","font","fontOffsetY","fontOffsetX","overrideEmissive","color"],g=i=>{let{el:l,children:o,material:c,scale:p,font:h,fontOffsetY:f=0,fontOffsetX:g=0,overrideEmissive:S=!1,color:w}=i,y=v(i,d);const{size:_}=a(),{scaleMultiplier:x}=s(),{textColor:k,fontSize:E,textAlign:z,lineHeight:b,letterSpacing:F}=t(()=>{if(!l.current)return{};const e=window.getComputedStyle(l.current);return{letterSpacing:(parseFloat(e.letterSpacing)||0)/parseFloat(e.fontSize),lineHeight:(parseFloat(e.lineHeight)||0)/parseFloat(e.fontSize),textColor:new n(w||e.color).convertSRGBToLinear(),fontSize:parseFloat(e.fontSize)*x,textAlign:e.textAlign}},[l,_,p,w,x]);r(()=>{c&&S&&(c.emissive=w)},[c,w,S]);let O=0;return"left"===z||"start"===z?O=-.5*p[0]:"right"!==z&&"end"!==z||(O=.5*p[0]),e.createElement(u,m({fontSize:E,maxWidth:p?p[0]:_.width,lineHeight:b,textAlign:z,letterSpacing:F,overflowWrap:"break-word",font:h,color:k,anchorX:z,anchorY:"top",position:[O+E*g,(p?.5*p[1]:.5*_.height)+E*f,0],material:c},y),o)},S=["el","scale","scrollState","vertexShader","fragmentShader","invalidateFrameLoop","widthSegments","heightSegments"],w=i((i,u)=>{let{el:f,scale:d,scrollState:g,vertexShader:w,fragmentShader:y,invalidateFrameLoop:_=!1,widthSegments:x=128,heightSegments:k=128}=i,E=v(i,S);const z=l(null),b=l(null),{invalidate:F,gl:O,size:L}=a(),M=a(e=>e.viewport.dpr),{scroll:V}=p(),{scaleMultiplier:j}=s(),A=h(f),C=t(()=>({u_color:{value:new n("black")},u_time:{value:0},u_pixelRatio:{value:M},u_progress:{value:0},u_visibility:{value:0},u_viewport:{value:0},u_velocity:{value:0},u_res:{value:new o},u_rect:{value:new o},u_size:{value:new o},u_texture:{value:null},u_loaded:{value:!1},u_scaleMultiplier:{value:j}}),[M]);r(()=>{A&&z.current&&(z.current.uniforms.u_texture.value=A,z.current.uniforms.u_size.value.set(A.image.width,A.image.height),z.current.uniforms.u_loaded.value=!0)},[A,O]),r(()=>{z.current&&(z.current.uniforms.u_res.value.set(L.width,L.height),z.current.uniforms.u_rect.value.set(null==d?void 0:d[0],null==d?void 0:d[1]))},[L,d]),c((e,t)=>{g.inViewport&&b.current&&z.current&&z.current.uniforms.u_loaded.value&&(z.current.uniforms.u_time.value+=t,z.current.uniforms.u_rect.value.set(b.current.scale.x,b.current.scale.y),z.current.uniforms.u_velocity.value=V.velocity,z.current.uniforms.u_progress.value=g.progress,z.current.uniforms.u_visibility.value=g.visibility,z.current.uniforms.u_viewport.value=g.viewport,_&&F())});const H=t(()=>[{vertexShader:w,fragmentShader:y}],[w,y]);return e.createElement(e.Fragment,null,e.createElement("mesh",m({ref:(B=[b,u],function(e){B.forEach(function(t){"function"==typeof t?t(e):null!=t&&(t.current=e)})})},E),e.createElement("planeGeometry",{attach:"geometry",args:[1,1,x,k]}),e.createElement("shaderMaterial",{ref:z,args:H,transparent:!0,uniforms:C})));var B}),y=["children","speed"],_=({children:t,scrollState:r,parallax:i})=>{const n=l(null),o=a(e=>e.size),{scaleMultiplier:u}=s();return c(()=>{r.inViewport&&(n.current.position.y=i*(2*r.progress-1)*u*o.height)}),e.createElement("mesh",{ref:n},t)},x=t=>{let{children:r,speed:i=1}=t,l=v(t,y);const n=i-1;return e.createElement(f,m({scissor:!1,inViewportMargin:200*Math.max(0,.5)+50+"%"},l),t=>e.createElement(_,m({parallax:n},t),r(t)))},k=["scale"],E=["children","track","stickyLerp","fillViewport"],z=({children:t,childTop:r,childBottom:i,scrollState:n,parentScale:o,childScale:u,priority:s,stickyLerp:p=1})=>{const h=l(null),f=a(e=>e.size);return c((e,t)=>{if(!n.inViewport)return;const l=.5*o[1]-.5*u[1];let a=h.current.position.y;a=n.viewport+r/f.height<1?l:n.visibility-i/o[1]<1?-r+l-(n.viewport-1)*f.height:.5*-o[1]+.5*u[1],h.current.position.y=function(e,t,r,i,l=60){return n=t,e*(1-(o=void 0===i?r:1-Math.pow(1-r,i/(1/l))))+n*o;var n,o}(h.current.position.y,a,p,t)},s),e.createElement("group",{ref:h},t)},b=r=>{let{children:i,track:n,stickyLerp:o,fillViewport:c}=r,u=v(r,E);const s=a(e=>e.size),p=l(n.current),h=t(()=>{const e=getComputedStyle(n.current);return"sticky"===e.position?p.current=n.current.parentElement:console.error("StickyScrollScene: tracked element is not position:sticky"),e},[n]);return e.createElement(f,m({track:p},u),((t,r,i,{stickyLerp:l,fillViewport:n})=>o=>{let{scale:a}=o,c=v(o,k),u=[parseFloat(i.width),parseFloat(i.height),1],s=parseFloat(i.top),p=r.height-s-u[1];return n&&(u=[r.width,r.height,1],s=0,p=0),e.createElement(z,m({parentScale:a,childScale:u,stickyLerp:l,childTop:s,childBottom:p},c),t(m({scale:u},c)))})(i,s,h,{stickyLerp:o,fillViewport:c}))};export{x as ParallaxScrollScene,b as StickyScrollScene,w as WebGLImage,g as WebGLText};
//# sourceMappingURL=powerups.modern.js.map
