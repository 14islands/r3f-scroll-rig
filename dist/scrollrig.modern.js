import e,{useLayoutEffect as r,useEffect as t,forwardRef as n,useRef as o,useImperativeHandle as l,useMemo as i,Fragment as a,cloneElement as s,Component as c,useState as u,useCallback as d,memo as p}from"react";import{useThree as h,invalidate as g,useFrame as m,Canvas as v,createPortal as f,useLoader as w,addEffect as b}from"@react-three/fiber";import{ResizeObserver as y}from"@juggle/resize-observer";import{parse as S}from"query-string";import R from"zustand";import{Vector2 as E,Color as C,Scene as T,MathUtils as I,DefaultLoadingManager as O,TextureLoader as L,ImageBitmapLoader as M,Texture as k,CanvasTexture as P}from"three";import{useInView as x}from"react-intersection-observer";import V from"debounce";import D from"vecn";import{suspend as A}from"suspend-react";import j from"supports-webp";import _ from"fast-deep-equal";import U from"@studio-freight/lenis";function z(){return z=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},z.apply(this,arguments)}function F(e,r){if(null==e)return{};var t,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)r.indexOf(t=l[n])>=0||(o[t]=e[t]);return o}function Y(e){var r=function(e,r){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof r?r:String(r)}const Q="undefined"!=typeof window?r:t,q={PRIORITY_PRELOAD:0,PRIORITY_SCISSORS:1,PRIORITY_VIEWPORTS:1,PRIORITY_GLOBAL:1e3,DEFAULT_SCALE_MULTIPLIER:1,preloadQueue:[]},B=R(e=>({debug:!1,scaleMultiplier:q.DEFAULT_SCALE_MULTIPLIER,globalRender:!0,globalPriority:q.PRIORITY_GLOBAL,globalClearDepth:!1,globalRenderQueue:!1,clearGlobalRenderQueue:()=>e(()=>({globalRenderQueue:!1})),isCanvasAvailable:!0,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(r,t,n={})=>e(({canvasChildren:e})=>Object.getOwnPropertyDescriptor(e,r)?(e[r].instances+=1,e[r].props.inactive=!1,{canvasChildren:e}):{canvasChildren:z({},e,{[r]:{mesh:t,props:n,instances:1}})}),updateCanvas:(r,t)=>e(({canvasChildren:e})=>{if(!e[r])return;const{[r]:{mesh:n,props:o,instances:l}}=e;return{canvasChildren:z({},e,{[r]:{mesh:n,props:z({},o,t),instances:l}})}}),removeFromCanvas:(r,t=!0)=>e(({canvasChildren:e})=>{var n;return(null==(n=e[r])?void 0:n.instances)>1?(e[r].instances-=1,{canvasChildren:e}):t?{canvasChildren:F(e,[r].map(Y))}:(e[r].instances=0,e[r].props.inactive=!0,{canvasChildren:z({},e)})}),pageReflow:0,requestReflow:()=>{e(e=>({pageReflow:e.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},scrollTo:e=>window.scrollTo(0,e),onScroll:()=>()=>{}})),G=()=>{const e=B(e=>e.requestReflow),r=B(e=>e.debug);return t(()=>{let t=new(window.ResizeObserver||y)(()=>{e(),r&&console.log("ResizeManager","document.body height changed")});return t.observe(document.body),()=>{null==t||t.disconnect()}},[]),null},W=["makeDefault","margin"],H=n((r,t)=>{let{makeDefault:n=!1,margin:a=0}=r,s=F(r,W);const c=h(e=>e.set),u=h(e=>e.camera),d=h(e=>e.size),p=h(e=>e.viewport),g=o(null);l(t,()=>g.current);const m=B(e=>e.pageReflow),v=B(e=>e.scaleMultiplier),{fov:f,distance:w,aspect:b}=i(()=>{var e;const r=(d.height+2*a)*v,t=(d.width+2*a)*v/r;let n=s.fov||50,o=null==s||null==(e=s.position)?void 0:e[2];return o?n=180/Math.PI*2*Math.atan(r/(2*o)):o=r/(2*Math.tan(n/2*Math.PI/180)),{fov:n,distance:o,aspect:t}},[d,v,m]);return Q(()=>{g.current.lookAt(0,0,0),g.current.updateProjectionMatrix(),g.current.updateMatrixWorld(),c(e=>({viewport:z({},e.viewport,p.getCurrentViewport(u))}))},[d,v,m]),Q(()=>{if(n){const e=u;return c(()=>({camera:g.current})),()=>c(()=>({camera:e}))}},[g,n,c]),e.createElement("perspectiveCamera",z({ref:g,position:[0,0,w],onUpdate:e=>e.updateProjectionMatrix(),near:.1,aspect:b,fov:f,far:2*w},s))}),X=["makeDefault","margin"],J=n((r,t)=>{let{makeDefault:n=!1,margin:a=0}=r,s=F(r,X);const c=h(e=>e.set),u=h(e=>e.camera),d=h(e=>e.size),p=B(e=>e.pageReflow),g=B(e=>e.scaleMultiplier),m=i(()=>Math.max(d.width*g,d.height*g),[d,p,g]),v=o(null);return l(t,()=>v.current),Q(()=>{v.current.lookAt(0,0,0),v.current.updateProjectionMatrix(),v.current.updateMatrixWorld()},[m,d]),Q(()=>{if(n){const e=u;return c(()=>({camera:v.current})),()=>c(()=>({camera:e}))}},[v,n,c]),e.createElement("orthographicCamera",z({left:d.width*g/-2-a*g,right:d.width*g/2+a*g,top:d.height*g/2+a*g,bottom:d.height*g/-2-a*g,far:2*m,position:[0,0,m],near:.001,ref:v,onUpdate:e=>e.updateProjectionMatrix()},s))});function K(e,r){e&&(!1===r?(e.wasFrustumCulled=e.frustumCulled,e.wasVisible=e.visible,e.visible=!0,e.frustumCulled=!1):(e.visible=!!e.wasVisible,e.frustumCulled=!!e.wasFrustumCulled),e.children.forEach(e=>K(e,r)))}const N=new E,Z=(e=[0])=>{B.getState().globalRenderQueue=B.getState().globalRenderQueue||[0],B.getState().globalRenderQueue=[...B.getState().globalRenderQueue||[],...e]},$=({gl:e,scene:r,camera:t,left:n,top:o,width:l,height:i,layer:a=0,autoClear:s=!1,clearDepth:c=!1})=>{r&&t&&(e.autoClear=s,e.setScissor(n,o,l,i),e.setScissorTest(!0),t.layers.set(a),c&&e.clearDepth(),e.render(r,t),e.setScissorTest(!1))},ee=({gl:e,scene:r,camera:t,left:n,top:o,width:l,height:i,layer:a=0,scissor:s=!0,autoClear:c=!1,clearDepth:u=!1})=>{r&&t&&(e.getSize(N),e.autoClear=c,e.setViewport(n,o,l,i),e.setScissor(n,o,l,i),e.setScissorTest(s),t.layers.set(a),u&&e.clearDepth(),e.render(r,t),e.setScissorTest(!1),e.setViewport(0,0,N.x,N.y))},re=(e,r,t=0,n)=>{q.preloadQueue.push((o,l,i)=>{o.setScissorTest(!1),K(e||l,!1),r.layers.set(t),o.render(e||l,r||i),K(e||l,!0),n&&n()}),g()},te=()=>{const e=B(e=>e.isCanvasAvailable),r=B(e=>e.hasSmoothScrollbar),n=B(e=>e.requestReflow),o=B(e=>e.pageReflow),l=B(e=>e.debug),i=B(e=>e.scaleMultiplier);return t(()=>{l&&(window._scrollRig=window._scrollRig||{},window._scrollRig.reflow=n)},[]),{debug:l,isCanvasAvailable:e,hasSmoothScrollbar:r,scaleMultiplier:i,preloadScene:re,requestRender:Z,renderScissor:$,renderViewport:ee,reflow:n,reflowCompleted:o}},ne=({children:r})=>{const n=h(e=>e.gl),o=B(e=>e.canvasChildren),l=te();return t(()=>{Object.keys(o).length||(l.debug&&console.log("GlobalRenderer","auto render empty canvas"),n.clear(),l.requestRender(),g())},[o]),l.debug&&console.log("GlobalChildren",Object.keys(o).length),e.createElement(e.Fragment,null,r,Object.keys(o).map(r=>{const{mesh:t,props:n}=o[r];return"function"==typeof t?e.createElement(a,{key:r},t(z({key:r},l,n))):s(t,z({key:r},n))}))},oe=()=>{const e=h(e=>e.gl),r=h(e=>e.frameloop),t=B(e=>e.globalClearDepth),n=B(e=>e.globalPriority),o=te();return Q(()=>{e.debug.checkShaderErrors=o.debug},[o.debug]),m(({camera:r,scene:t})=>{q.preloadQueue.length&&(q.preloadQueue.forEach(n=>n(e,t,r)),e.clear(),q.preloadQueue=[],o.debug&&console.log("GlobalRenderer","preload complete. trigger global render"),o.requestRender(),g())},q.PRIORITY_PRELOAD),m(({camera:n,scene:o})=>{const l=B.getState().globalRenderQueue;("always"===r||l)&&(n.layers.disableAll(),l?l.forEach(e=>{n.layers.enable(e)}):n.layers.enable(0),t&&e.clearDepth(),e.render(o,n)),B.getState().clearGlobalRenderQueue()},n),null};class le extends c{constructor(e){super(e),this.state={error:!1},this.props=e}static getDerivedStateFromError(e){return{error:e}}render(){return this.state.error?(this.props.onError&&this.props.onError(this.state.error),null):this.props.children}}const ie=["children","gl","style","orthographic","camera","debug","scaleMultiplier","globalRender","globalPriority","globalClearDepth"],ae=["children","onError"];let se;"undefined"!=typeof window&&(se=window.ResizeObserver||y);const ce=r=>{let{children:t,gl:n,style:o,orthographic:l,camera:i,debug:a,scaleMultiplier:s=q.DEFAULT_SCALE_MULTIPLIER,globalRender:c=!0,globalPriority:u=q.PRIORITY_GLOBAL,globalClearDepth:d=!1}=r,p=F(r,ie);const h=B(e=>e.globalRender);return Q(()=>{const e=S(window.location.search);(a||void 0!==e.debug)&&B.setState({debug:!0})},[a]),Q(()=>{B.setState({scaleMultiplier:s,globalRender:c,globalPriority:u,globalClearDepth:d})},[s,u,c,d]),e.createElement(v,z({id:"ScrollRig-canvas",camera:{manual:!0},gl:z({failIfMajorPerformanceCaveat:!0},n),resize:{scroll:!1,debounce:0,polyfill:se},style:z({position:"fixed",top:0,left:0,right:0,height:"100vh"},o)},p),!l&&e.createElement(H,z({manual:!0,makeDefault:!0},i)),l&&e.createElement(J,z({manual:!0,makeDefault:!0},i)),h&&e.createElement(oe,null),"function"==typeof t?t(e.createElement(ne,null)):e.createElement(ne,null,t),e.createElement(G,null))},ue=r=>{let{children:t,onError:n}=r,o=F(r,ae);return Q(()=>{document.documentElement.classList.add("js-has-global-canvas")},[]),e.createElement(le,{onError:e=>{n&&n(e),B.setState({isCanvasAvailable:!1}),document.documentElement.classList.remove("js-has-global-canvas"),document.documentElement.classList.add("js-global-canvas-error")}},e.createElement(ce,z({},o),t),e.createElement("noscript",null,e.createElement("style",null,"\n          .ScrollRig-visibilityHidden,\n          .ScrollRig-transparentColor {\n            visibility: unset;\n            color: unset;\n          }\n          ")))},de=({scale:r})=>e.createElement("mesh",{scale:r},e.createElement("planeGeometry",null),e.createElement("shaderMaterial",{args:[{uniforms:{color:{value:new C("hotpink")}},vertexShader:"\n            void main() {\n              gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n          ",fragmentShader:"\n            uniform vec3 color;\n            uniform float opacity;\n            void main() {\n              gl_FragColor.rgba = vec4(color, .5);\n            }\n          "}],transparent:!0})),pe="undefined"!=typeof window;function he({debounce:e=0}={}){const[r,n]=u({width:pe?window.innerWidth:Infinity,height:pe?window.innerHeight:Infinity});return t(()=>{const t=document.getElementById("ScrollRig-canvas");function o(){const e=t?t.clientWidth:window.innerWidth,o=t?t.clientHeight:window.innerHeight;e===r.width&&o===r.height||n({width:e,height:o})}const l=V.debounce(o,e),i=window.ResizeObserver||y;let a;return t?(a=new i(l),a.observe(t)):window.addEventListener("resize",l),o(),()=>{var e;window.removeEventListener("resize",l),null==(e=a)||e.disconnect()}},[r,n]),r}function ge(e,r,t,n,o){return n+(e-r)*(o-n)/(t-r)}const me=()=>({enabled:B(e=>e.hasSmoothScrollbar),scroll:B(e=>e.scroll),scrollTo:B(e=>e.scrollTo),onScroll:B(e=>e.onScroll)});function ve(e,r){const n=he(),{scroll:l,onScroll:a}=me(),s=B(e=>e.scaleMultiplier),c=B(e=>e.pageReflow),p=B(e=>e.debug),{rootMargin:h,threshold:g,autoUpdate:m,wrapper:v}=i(()=>{const e={rootMargin:"0%",threshold:0,autoUpdate:!0},t=r||{};return Object.keys(t).map((r,n)=>{void 0!==t[r]&&(e[r]=t[r])}),e},[r]),{ref:f,inView:w}=x({rootMargin:h,threshold:g});Q(()=>{f(e.current)},[e]);const[b,y]=u(D.vec3(0,0,0)),S=o({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,R=o({top:0,bottom:0,left:0,right:0,width:0,height:0}).current,[E,C]=u(R),T=o({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,I=o(D.vec3(0,0,0)).current;Q(()=>{var r;const t=null==(r=e.current)?void 0:r.getBoundingClientRect();if(!t)return;const o=v?v.scrollTop:window.scrollY,l=v?v.scrollLeft:window.scrollX;R.top=t.top+o,R.bottom=t.bottom+o,R.left=t.left+l,R.right=t.right+l,R.width=t.width,R.height=t.height,C(z({},R)),y(D.vec3((null==R?void 0:R.width)*s,(null==R?void 0:R.height)*s,1)),p&&console.log("useTracker.getBoundingClientRect:",R,"intialScroll:",{initialY:o,initialX:l},"size:",n,"pageReflow:",c)},[e,n,c,s,p]);const O=d(({onlyUpdateInViewport:r=!1,scroll:t}={})=>{if(!e.current||r&&!S.inViewport)return;const o=t||l;!function(e,r,t,n){e.top=r.top-(t.y||0),e.bottom=r.bottom-(t.y||0),e.left=r.left-(t.x||0),e.right=r.right-(t.x||0),e.width=r.width,e.height=r.height,e.x=e.left+.5*r.width-.5*n.width,e.y=e.top+.5*r.height-.5*n.height,e.positiveYUpBottom=n.height-e.bottom}(T,R,o,n),function(e,r,t){e.x=r.x*t,e.y=-1*r.y*t}(I,T,s);const i="horizontal"===o.scrollDirection,a=i?"width":"height",c=n[a]-T[i?"left":"top"];S.progress=ge(c,0,n[a]+T[a],0,1),S.visibility=ge(c,0,T[a],0,1),S.viewport=ge(c,0,n[a],0,1)},[e,n,s,l]);return Q(()=>{S.inViewport=w,O({onlyUpdateInViewport:!1}),p&&console.log("useTracker.inViewport:",w,"update()")},[w]),Q(()=>{O({onlyUpdateInViewport:!1}),p&&console.log("useTracker.update on resize/reflow")},[O,c]),t(()=>{if(m)return a(e=>O({onlyUpdateInViewport:!0}))},[m,O,a]),{rect:E,bounds:T,scale:b,position:I,scrollState:S,inViewport:w,update:O}}const fe=["track","children","margin","inViewportMargin","inViewportThreshold","visible","hideOffscreen","scissor","debug","as","priority"],we=p(r=>{let{track:t,children:n,margin:o=0,inViewportMargin:l,inViewportThreshold:i,visible:a=!0,hideOffscreen:s=!0,scissor:c=!1,debug:p=!1,as:h="scene",priority:g=q.PRIORITY_SCISSORS}=r,v=F(r,fe);const w=d(e=>{null!==e&&y(e)},[]),[b,y]=u(c?new T:null),{requestRender:S,renderScissor:R}=te(),E=B(e=>e.globalRender),{bounds:C,scale:I,position:O,scrollState:L,inViewport:M}=ve(t,{rootMargin:l,threshold:i});Q(()=>{b&&(b.visible=s?M&&a:a)},[b,M,s,a]),m(({gl:e,camera:r})=>{b&&b.visible&&(b.position.y=O.y,b.position.x=O.x,c?R({gl:e,scene:b,camera:r,left:C.left-o,top:C.positiveYUpBottom-o,width:C.width+2*o,height:C.height+2*o}):S())},E?g:void 0);const k=e.createElement(e.Fragment,null,(!n||p)&&I&&e.createElement(de,{scale:I}),n&&b&&I&&n(z({track:t,margin:o,scale:I,scrollState:L,inViewport:M,priority:g},v))),P=h;return c&&b?f(k,b):e.createElement(P,{ref:w},k)}),be=["track","children","margin","visible","hideOffscreen","debug","orthographic","priority","inViewport","bounds","scale","scrollState","camera","hud"],ye=["track","margin","inViewportMargin","inViewportThreshold","priority"],Se=["bounds"],Re=r=>{let{track:n,children:o,margin:l=0,visible:i=!0,hideOffscreen:a=!0,debug:s=!1,orthographic:c=!1,priority:u=q.PRIORITY_VIEWPORTS,inViewport:d,bounds:p,scale:g,scrollState:v,camera:f,hud:w}=r,b=F(r,be);const y=h(e=>e.scene),S=h(e=>e.get),R=h(e=>e.setEvents),{renderViewport:E}=te();return Q(()=>{y.visible=a?d&&i:i},[d,a,i]),t(()=>{const e=S().events.connected;return R({connected:n.current}),()=>R({connected:e})},[]),m(({gl:e,scene:r,camera:t})=>{r.visible&&E({gl:e,scene:r,camera:t,left:p.left-l,top:p.positiveYUpBottom-l,width:p.width+2*l,height:p.height+2*l,clearDepth:!!w})},u),e.createElement(e.Fragment,null,!c&&e.createElement(H,z({manual:!0,margin:l,makeDefault:!0},f)),c&&e.createElement(J,z({manual:!0,margin:l,makeDefault:!0},f)),(!o||s)&&g&&e.createElement(de,{scale:g}),o&&g&&o(z({track:n,margin:l,scale:g,scrollState:v,inViewport:d,priority:u},b)))},Ee=p(function(r){let{track:t,margin:n=0,inViewportMargin:o,inViewportThreshold:l,priority:i}=r,a=F(r,ye);const[s]=u(()=>new T),c=ve(t,{rootMargin:o,threshold:l}),{bounds:p}=c,h=F(c,Se),g=d((e,r)=>{if(t.current&&e.target===t.current){const{width:t,height:o,left:l,top:i}=p;r.pointer.set((e.clientX-l+n)/(t+2*n)*2-1,-(e.clientY-i+n)/(o+2*n)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)}},[p]);return p&&f(e.createElement(Re,z({track:t,bounds:p,priority:i,margin:n},a,h)),s,{events:{compute:g,priority:i},size:{width:p.width,height:p.height}})});function Ce(e,r={},{key:n,dispose:o=!0}={}){const l=B(e=>e.updateCanvas),a=B(e=>e.renderToCanvas),s=B(e=>e.removeFromCanvas),c=i(()=>n||I.generateUUID(),[]);Q(()=>{a(c,e,{inactive:!1})},[c]),t(()=>()=>{s(c,o)},[c]);const u=d(e=>{l(c,e)},[l,c]);return t(()=>{u(r)},[...Object.values(r)]),u}const Te=["children","id","dispose"],Ie=n((e,r)=>{let{children:t,id:n,dispose:o=!0}=e;return Ce(t,z({},F(e,Te),{ref:r}),{key:n,dispose:o}),null});let Oe=!1;function Le(e,{initTexture:r=!0,premultiplyAlpha:n="default"}={}){var o,l;const a=h(e=>e.gl),s=he(),c=B(e=>e.debug),[d,p]=u(null==(o=e.current)?void 0:o.currentSrc);t(()=>{const r=e.current,t=()=>{var r;p(null==(r=e.current)?void 0:r.currentSrc)};return null==r||r.addEventListener("load",t),()=>null==r?void 0:r.removeEventListener("load",t)},[e,d,p]);const g=A(()=>(O.itemStart("waiting for DOM image"),new Promise(r=>{const t=e.current;function n(){r(null==t?void 0:t.currentSrc),O.itemEnd("waiting for DOM image")}null==t||t.addEventListener("load",n,{once:!0}),null!=t&&t.complete&&(null==t||t.removeEventListener("load",n),n())})),[e,s,null==(l=e.current)?void 0:l.currentSrc,d],{equal:_}),m=function(){const e=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=navigator.userAgent.indexOf("Firefox")>-1,t=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;return"undefined"==typeof createImageBitmap||e||r&&t<98}()?L:M,v=w(m,g,e=>{e instanceof M&&(e.setOptions({colorSpaceConversion:"none",premultiplyAlpha:n,imageOrientation:"flipY"}),e.setRequestHeader({Accept:(Oe?"image/webp,":"")+"*/*"}))}),f=i(()=>v instanceof k?v:v instanceof ImageBitmap?new P(v):void 0,[v]);return t(function(){r&&a.initTexture(f),c&&console.log("useImageAsTexture","initTexture()")},[a,f,r]),f}j.then(e=>{Oe=e});const Me=n(({children:e,enabled:r=!0,locked:n=!1,scrollRestoration:i="auto",disablePointerOnScroll:a=!0,horizontal:s=!1,scrollInContainer:c=!1,updateGlobalState:u=!0,onScroll:p,config:h={},invalidate:g=(()=>{}),addEffect:m},v)=>{const f=o(),w=o(),b=o(!1),y=B(e=>e.scroll);l(v,()=>({start:()=>{var e;return null==(e=w.current)?void 0:e.start()},stop:()=>{var e;return null==(e=w.current)?void 0:e.stop()},on:(e,r)=>{var t;return null==(t=w.current)?void 0:t.on(e,r)},once:(e,r)=>{var t;return null==(t=w.current)?void 0:t.once(e,r)},off:(e,r)=>{var t;return null==(t=w.current)?void 0:t.off(e,r)},notify:()=>{var e;return null==(e=w.current)?void 0:e.notify()},scrollTo:(e,r)=>{var t;return null==(t=w.current)?void 0:t.scrollTo(e,r)},raf:e=>{var r;return null==(r=w.current)?void 0:r.raf(e)},__lenis:w.current}));const S=d(e=>{a&&f.current&&b.current!==e&&(b.current=e,f.current.style.pointerEvents=e?"none":"auto")},[a,f,b]);return Q(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=i)},[]),Q(()=>{const e=document.documentElement,r=document.body,t=document.body.firstElementChild;let n;if(e.classList.toggle("ScrollRig-scrollHtml",c),r.classList.toggle("ScrollRig-scrollWrapper",c),c&&Object.assign(h,{smoothTouch:!0,wrapper:r,content:t}),w.current=new U(z({direction:s?"horizontal":"vertical"},h)),m)n=m(e=>{var r;return null==(r=w.current)?void 0:r.raf(e)});else{let e;e=requestAnimationFrame(function r(t){var n;null==(n=w.current)||n.raf(t),e=requestAnimationFrame(r)}),n=()=>cancelAnimationFrame(e)}return()=>{var e;n(),null==(e=w.current)||e.destroy()}},[]),Q(()=>{var e,r,t;return null==(e=w.current)||e.on("scroll",({scroll:e,limit:r,velocity:t,direction:n,progress:o})=>{const l=s?e:0;u&&(y.y=s?0:e,y.x=l,y.limit=r,y.velocity=t,y.direction=n,y.progress=o),Math.abs(t)>1.5&&S(!0),Math.abs(t)<1&&S(!1),p&&p({scroll:e,limit:r,velocity:t,direction:n,progress:o}),g()}),u&&(y.scrollDirection=s?"horizontal":"vertical",B.setState({scrollTo:null==(t=w.current)?void 0:t.scrollTo}),B.setState({onScroll:e=>{var r,t;return null==(r=w.current)||r.on("scroll",e),null==(t=w.current)||t.notify(),()=>{var r;return null==(r=w.current)?void 0:r.off("scroll",e)}}}),B.getState().scroll.y=window.scrollY,B.getState().scroll.x=window.scrollX),null==(r=w.current)||r.notify(),()=>{var e;null==(e=w.current)||e.off("scroll")}},[]),Q(()=>{const e=()=>g(),r=()=>S(!1);return window.addEventListener("pointermove",r),window.addEventListener("pointerdown",r),window.addEventListener("wheel",e),()=>{var t;null==(t=w.current)||t.off("scroll"),window.removeEventListener("pointermove",r),window.removeEventListener("pointerdown",r),window.removeEventListener("wheel",e)}},[]),t(()=>{u&&(document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",r),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!r),B.setState({hasSmoothScrollbar:r}))},[r]),t(()=>{var e,r;n?null==(e=w.current)||e.stop():null==(r=w.current)||r.start()},[n]),e({ref:f})});var ke=n(function(r,t){return e.createElement(Me,z({ref:t,invalidate:g,addEffect:b},r))});const Pe={hidden:"ScrollRig-visibilityHidden",hiddenWhenSmooth:"ScrollRig-visibilityHidden ScrollRig-hiddenIfSmooth",transparentColor:"ScrollRig-transparentColor",transparentColorWhenSmooth:"ScrollRig-transparentColor ScrollRig-hiddenIfSmooth"};export{ue as GlobalCanvas,we as ScrollScene,ke as SmoothScrollbar,Ie as UseCanvas,Ee as ViewportScrollScene,Pe as styles,Ce as useCanvas,B as useCanvasStore,Le as useImageAsTexture,te as useScrollRig,me as useScrollbar,ve as useTracker};
//# sourceMappingURL=scrollrig.modern.js.map
