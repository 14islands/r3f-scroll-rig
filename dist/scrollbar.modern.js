import e from"zustand";import{useLayoutEffect as t,useEffect as r,forwardRef as o,useRef as n,useImperativeHandle as l,useCallback as i,useState as s,useMemo as c}from"react";import a from"@studio-freight/lenis";import{useInView as u}from"react-intersection-observer";import{ResizeObserver as d}from"@juggle/resize-observer";import h from"debounce";import p from"vecn";import{Vector2 as v}from"three";import{invalidate as w}from"@react-three/fiber";function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},f.apply(this,arguments)}function g(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}const m={PRIORITY_PRELOAD:0,PRIORITY_SCISSORS:1,PRIORITY_VIEWPORTS:1,PRIORITY_GLOBAL:1e3,DEFAULT_SCALE_MULTIPLIER:1,preloadQueue:[]},b=e(e=>({debug:!1,scaleMultiplier:m.DEFAULT_SCALE_MULTIPLIER,globalRender:!0,globalPriority:m.PRIORITY_GLOBAL,globalClearDepth:!1,globalRenderQueue:!1,clearGlobalRenderQueue:()=>e(()=>({globalRenderQueue:!1})),isCanvasAvailable:!0,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(t,r,o={})=>e(({canvasChildren:e})=>Object.getOwnPropertyDescriptor(e,t)?(e[t].instances+=1,e[t].props.inactive=!1,{canvasChildren:e}):{canvasChildren:f({},e,{[t]:{mesh:r,props:o,instances:1}})}),updateCanvas:(t,r)=>e(({canvasChildren:e})=>{if(!e[t])return;const{[t]:{mesh:o,props:n,instances:l}}=e;return{canvasChildren:f({},e,{[t]:{mesh:o,props:f({},n,r),instances:l}})}}),removeFromCanvas:(t,r=!0)=>e(({canvasChildren:e})=>{var o;return(null==(o=e[t])?void 0:o.instances)>1?(e[t].instances-=1,{canvasChildren:e}):r?{canvasChildren:function(e,t){if(null==e)return{};var r,o,n={},l=Object.keys(e);for(o=0;o<l.length;o++)t.indexOf(r=l[o])>=0||(n[r]=e[r]);return n}(e,[t].map(g))}:(e[t].instances=0,e[t].props.inactive=!0,{canvasChildren:f({},e)})}),pageReflow:0,requestReflow:()=>{e(e=>({pageReflow:e.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},scrollTo:e=>window.scrollTo(0,e),onScroll:()=>()=>{}})),y=()=>({enabled:b(e=>e.hasSmoothScrollbar),scroll:b(e=>e.scroll),scrollTo:b(e=>e.scrollTo),onScroll:b(e=>e.onScroll)}),S="undefined"!=typeof window?t:r,R=o(({children:e,enabled:t=!0,locked:o=!1,scrollRestoration:s="auto",disablePointerOnScroll:c=!0,horizontal:u=!1,scrollInContainer:d=!1,updateGlobalState:h=!0,onScroll:p,config:v={},invalidate:w=(()=>{}),addEffect:g},m)=>{const y=n(),R=n(),C=n(!1),T=b(e=>e.scroll);l(m,()=>({start:()=>{var e;return null==(e=R.current)?void 0:e.start()},stop:()=>{var e;return null==(e=R.current)?void 0:e.stop()},on:(e,t)=>{var r;return null==(r=R.current)?void 0:r.on(e,t)},once:(e,t)=>{var r;return null==(r=R.current)?void 0:r.once(e,t)},off:(e,t)=>{var r;return null==(r=R.current)?void 0:r.off(e,t)},notify:()=>{var e;return null==(e=R.current)?void 0:e.notify()},scrollTo:(e,t)=>{var r;return null==(r=R.current)?void 0:r.scrollTo(e,t)},raf:e=>{var t;return null==(t=R.current)?void 0:t.raf(e)},__lenis:R.current}));const L=i(e=>{c&&y.current&&C.current!==e&&(C.current=e,y.current.style.pointerEvents=e?"none":"auto")},[c,y,C]);return S(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=s)},[]),S(()=>{const e=document.documentElement,t=document.body,r=document.body.firstElementChild;let o;if(e.classList.toggle("ScrollRig-scrollHtml",d),t.classList.toggle("ScrollRig-scrollWrapper",d),d&&Object.assign(v,{smoothTouch:!0,wrapper:t,content:r}),R.current=new a(f({direction:u?"horizontal":"vertical"},v)),g)o=g(e=>{var t;return null==(t=R.current)?void 0:t.raf(e)});else{let e;e=requestAnimationFrame(function t(r){var o;null==(o=R.current)||o.raf(r),e=requestAnimationFrame(t)}),o=()=>cancelAnimationFrame(e)}return()=>{var e;o(),null==(e=R.current)||e.destroy()}},[]),S(()=>{var e,t,r;return null==(e=R.current)||e.on("scroll",({scroll:e,limit:t,velocity:r,direction:o,progress:n})=>{const l=u?e:0;h&&(T.y=u?0:e,T.x=l,T.limit=t,T.velocity=r,T.direction=o,T.progress=n),Math.abs(r)>1.5&&L(!0),Math.abs(r)<1&&L(!1),p&&p({scroll:e,limit:t,velocity:r,direction:o,progress:n}),w()}),h&&(T.scrollDirection=u?"horizontal":"vertical",b.setState({scrollTo:null==(r=R.current)?void 0:r.scrollTo}),b.setState({onScroll:e=>{var t;return null==(t=R.current)||t.on("scroll",e),()=>{var t;return null==(t=R.current)?void 0:t.off("scroll",e)}}}),b.getState().scroll.y=window.scrollY,b.getState().scroll.x=window.scrollX),null==(t=R.current)||t.notify(),()=>{var e;null==(e=R.current)||e.off("scroll")}},[]),S(()=>{const e=()=>w(),t=()=>L(!1);return window.addEventListener("pointermove",t),window.addEventListener("pointerdown",t),window.addEventListener("wheel",e),()=>{var r;null==(r=R.current)||r.off("scroll"),window.removeEventListener("pointermove",t),window.removeEventListener("pointerdown",t),window.removeEventListener("wheel",e)}},[]),r(()=>{h&&(document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",t),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!t),b.setState({hasSmoothScrollbar:t}))},[t]),r(()=>{var e,t;o?null==(e=R.current)||e.stop():null==(t=R.current)||t.start()},[o]),e({ref:y})}),C="undefined"!=typeof window;function T(e,t,r,o,n){return o+(e-t)*(n-o)/(r-t)}function L(e,t){e&&(!1===t?(e.wasFrustumCulled=e.frustumCulled,e.wasVisible=e.visible,e.visible=!0,e.frustumCulled=!1):(e.visible=!!e.wasVisible,e.frustumCulled=!!e.wasFrustumCulled),e.children.forEach(e=>L(e,t)))}const E=new v,I=(e=[0])=>{b.getState().globalRenderQueue=b.getState().globalRenderQueue||[0],b.getState().globalRenderQueue=[...b.getState().globalRenderQueue||[],...e]},O=({gl:e,scene:t,camera:r,left:o,top:n,width:l,height:i,layer:s=0,autoClear:c=!1,clearDepth:a=!1})=>{t&&r&&(e.autoClear=c,e.setScissor(o,n,l,i),e.setScissorTest(!0),r.layers.set(s),a&&e.clearDepth(),e.render(t,r),e.setScissorTest(!1))},V=({gl:e,scene:t,camera:r,left:o,top:n,width:l,height:i,layer:s=0,scissor:c=!0,autoClear:a=!1,clearDepth:u=!1})=>{t&&r&&(e.getSize(E),e.autoClear=a,e.setViewport(o,n,l,i),e.setScissor(o,n,l,i),e.setScissorTest(c),r.layers.set(s),u&&e.clearDepth(),e.render(t,r),e.setScissorTest(!1),e.setViewport(0,0,E.x,E.y))},P=(e,t,r=0,o)=>{m.preloadQueue.push((n,l,i)=>{n.setScissorTest(!1),L(e||l,!1),t.layers.set(r),n.render(e||l,t||i),L(e||l,!0),o&&o()}),w()};function _(e,t){const o=function({debounce:e=0}={}){const[t,o]=s({width:C?window.innerWidth:Infinity,height:C?window.innerHeight:Infinity});return r(()=>{const r=document.getElementById("ScrollRig-canvas");function n(){const e=r?r.clientWidth:window.innerWidth,n=r?r.clientHeight:window.innerHeight;e===t.width&&n===t.height||o({width:e,height:n})}const l=h.debounce(n,e),i=window.ResizeObserver||d;let s;return r?(s=new i(l),s.observe(r)):window.addEventListener("resize",l),n(),()=>{var e;window.removeEventListener("resize",l),null==(e=s)||e.disconnect()}},[t,o]),t}(),{debug:l}=(()=>{const e=b(e=>e.isCanvasAvailable),t=b(e=>e.hasSmoothScrollbar),o=b(e=>e.requestReflow),n=b(e=>e.pageReflow),l=b(e=>e.debug),i=b(e=>e.scaleMultiplier);return r(()=>{l&&(window._scrollRig=window._scrollRig||{},window._scrollRig.reflow=o)},[]),{debug:l,isCanvasAvailable:e,hasSmoothScrollbar:t,scaleMultiplier:i,preloadScene:P,requestRender:I,renderScissor:O,renderViewport:V,reflow:o,reflowCompleted:n}})(),{scroll:a,onScroll:v}=y(),w=b(e=>e.scaleMultiplier),g=b(e=>e.pageReflow),{rootMargin:m,threshold:R,autoUpdate:L,wrapper:E}=c(()=>{const e={rootMargin:"0%",threshold:0,autoUpdate:!0},r=t||{};return Object.keys(r).map((t,o)=>{void 0!==r[t]&&(e[t]=r[t])}),e},[t]),{ref:_,inView:A}=u({rootMargin:m,threshold:R});S(()=>{_(e.current)},[e]);const[j,x]=s(p.vec3(0,0,0)),z=n({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,D=n({top:0,bottom:0,left:0,right:0,width:0,height:0}).current,[U,M]=s(D),Y=n({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,Q=n(p.vec3(0,0,0)).current;S(()=>{var t;const r=null==(t=e.current)?void 0:t.getBoundingClientRect();if(!r)return;const n=E?E.scrollTop:window.scrollY,i=E?E.scrollLeft:window.scrollX;D.top=r.top+n,D.bottom=r.bottom+n,D.left=r.left+i,D.right=r.right+i,D.width=r.width,D.height=r.height,M(f({},D)),x(p.vec3((null==D?void 0:D.width)*w,(null==D?void 0:D.height)*w,1)),l&&console.log("useTracker.getBoundingClientRect:",D,"intialScroll:",{initialY:n,initialX:i},"size:",o,"pageReflow:",g)},[e,o,g,w,l]);const F=i(({onlyUpdateInViewport:t=!1,scroll:r}={})=>{if(!e.current||t&&!z.inViewport)return;const n=r||a;!function(e,t,r,o){e.top=t.top-(r.y||0),e.bottom=t.bottom-(r.y||0),e.left=t.left-(r.x||0),e.right=t.right-(r.x||0),e.width=t.width,e.height=t.height,e.x=e.left+.5*t.width-.5*o.width,e.y=e.top+.5*t.height-.5*o.height,e.positiveYUpBottom=o.height-e.bottom}(Y,D,n,o),function(e,t,r){e.x=t.x*r,e.y=-1*t.y*r}(Q,Y,w);const l="horizontal"===n.scrollDirection,i=l?"width":"height",s=o[i]-Y[l?"left":"top"];z.progress=T(s,0,o[i]+Y[i],0,1),z.visibility=T(s,0,Y[i],0,1),z.viewport=T(s,0,o[i],0,1)},[e,o,w,a]);return S(()=>{z.inViewport=A,F({onlyUpdateInViewport:!1}),l&&console.log("useTracker.inViewport:",A,"update()")},[A]),S(()=>{F({onlyUpdateInViewport:!1}),l&&console.log("useTracker.update on resize/reflow")},[F,g]),r(()=>{if(L)return v(e=>F({onlyUpdateInViewport:!0}))},[L,F,v]),{rect:U,bounds:Y,scale:j,position:Q,scrollState:z,inViewport:A,update:F}}export{R as SmoothScrollbar,y as useScrollbar,_ as useTracker};
//# sourceMappingURL=scrollbar.modern.js.map
