import e from"zustand";import{useLayoutEffect as t,useEffect as r,forwardRef as o,useRef as n,useImperativeHandle as i,useCallback as l,useState as c,useMemo as s}from"react";import a from"@studio-freight/lenis";import{useInView as u}from"react-intersection-observer";import{ResizeObserver as d}from"@juggle/resize-observer";import v from"debounce";import h from"vecn";function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},p.apply(this,arguments)}function w(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}const g=e(e=>({debug:!1,scaleMultiplier:1,globalRender:!0,globalPriority:1e3,globalClearDepth:!1,globalRenderQueue:!1,clearGlobalRenderQueue:()=>e(()=>({globalRenderQueue:!1})),isCanvasAvailable:!0,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(t,r,o={})=>e(({canvasChildren:e})=>Object.getOwnPropertyDescriptor(e,t)?(e[t].instances+=1,e[t].props.inactive=!1,{canvasChildren:e}):{canvasChildren:p({},e,{[t]:{mesh:r,props:o,instances:1}})}),updateCanvas:(t,r)=>e(({canvasChildren:e})=>{if(!e[t])return;const{[t]:{mesh:o,props:n,instances:i}}=e;return{canvasChildren:p({},e,{[t]:{mesh:o,props:p({},n,r),instances:i}})}}),removeFromCanvas:(t,r=!0)=>e(({canvasChildren:e})=>{var o;return(null==(o=e[t])?void 0:o.instances)>1?(e[t].instances-=1,{canvasChildren:e}):r?{canvasChildren:function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)t.indexOf(r=i[o])>=0||(n[r]=e[r]);return n}(e,[t].map(w))}:(e[t].instances=0,e[t].props.inactive=!0,{canvasChildren:p({},e)})}),pageReflow:0,requestReflow:()=>{e(e=>({pageReflow:e.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},scrollTo:()=>{},onScroll:()=>()=>{}})),m=()=>({enabled:g(e=>e.hasSmoothScrollbar),scroll:g(e=>e.scroll),scrollTo:g(e=>e.scrollTo),onScroll:g(e=>e.onScroll)}),f="undefined"!=typeof window?t:r,b=o(({children:e,enabled:t=!0,locked:o=!1,scrollRestoration:c="auto",disablePointerOnScroll:s=!0,horizontal:u=!1,scrollInContainer:d=!1,updateGlobalState:v=!0,onScroll:h,config:w={},invalidate:m=(()=>{}),addEffect:b},y)=>{const S=n(),C=n(),R=n(!1),E=g(e=>e.scroll);i(y,()=>({start:()=>{var e;return null==(e=C.current)?void 0:e.start()},stop:()=>{var e;return null==(e=C.current)?void 0:e.stop()},on:(e,t)=>{var r;return null==(r=C.current)?void 0:r.on(e,t)},notify:()=>{var e;return null==(e=C.current)?void 0:e.emit()},emit:()=>{var e;return null==(e=C.current)?void 0:e.emit()},scrollTo:(e,t)=>{var r;return null==(r=C.current)?void 0:r.scrollTo(e,t)},raf:e=>{var t;return null==(t=C.current)?void 0:t.raf(e)},__lenis:C.current}));const T=l(e=>{s&&S.current&&R.current!==e&&(R.current=e,S.current.style.pointerEvents=e?"none":"auto")},[s,S,R]);return f(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=c)},[]),f(()=>{const e=document.documentElement,t=document.body,r=document.body.firstElementChild;let o;if(e.classList.toggle("ScrollRig-scrollHtml",d),t.classList.toggle("ScrollRig-scrollWrapper",d),d&&Object.assign(w,{smoothTouch:!0,wrapper:t,content:r}),C.current=new a(p({orientation:u?"horizontal":"vertical"},w)),b)o=b(e=>{var t;return null==(t=C.current)?void 0:t.raf(e)});else{let e;e=requestAnimationFrame(function t(r){var o;null==(o=C.current)||o.raf(r),e=requestAnimationFrame(t)}),o=()=>cancelAnimationFrame(e)}return()=>{var e;o(),null==(e=C.current)||e.destroy()}},[]),f(()=>{var e,t;const r=({scroll:e,limit:t,velocity:r,direction:o,progress:n})=>{const i=u?e:0;v&&(E.y=u?0:e,E.x=i,E.limit=t,E.velocity=r,E.direction=o,E.progress=n||0),Math.abs(r)>1.5&&T(!0),Math.abs(r)<1&&T(!1),h&&h({scroll:e,limit:t,velocity:r,direction:o,progress:n}),m()};return null==(e=C.current)||e.on("scroll",r),v&&(E.scrollDirection=u?"horizontal":"vertical",g.setState({scrollTo:(...e)=>{var t;null==(t=C.current)||t.scrollTo(...e)},onScroll:e=>{var t,r;return null==(t=C.current)||t.on("scroll",e),null==(r=C.current)||r.emit(),()=>{var t;return null==(t=C.current)?void 0:t.off("scroll",e)}}}),g.getState().scroll.y=window.scrollY,g.getState().scroll.x=window.scrollX),null==(t=C.current)||t.emit(),()=>{var e;null==(e=C.current)||e.off("scroll",r),g.setState({onScroll:()=>()=>{},scrollTo:()=>{}})}},[]),f(()=>{const e=()=>m(),t=()=>T(!1);return window.addEventListener("pointermove",t),window.addEventListener("pointerdown",t),window.addEventListener("wheel",e),()=>{window.removeEventListener("pointermove",t),window.removeEventListener("pointerdown",t),window.removeEventListener("wheel",e)}},[]),r(()=>{v&&(document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",t),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!t),g.setState({hasSmoothScrollbar:t}))},[t]),r(()=>{var e,t;o?null==(e=C.current)||e.stop():null==(t=C.current)||t.start()},[o]),e({ref:S})}),y="undefined"!=typeof window;function S(e,t,r,o,n){return o+(e-t)*(n-o)/(r-t)}function C(e,t){const o=function({debounce:e=0}={}){const[t,o]=c({width:y?window.innerWidth:Infinity,height:y?window.innerHeight:Infinity});return r(()=>{const r=document.getElementById("ScrollRig-canvas");function n(){const e=r?r.clientWidth:window.innerWidth,n=r?r.clientHeight:window.innerHeight;e===t.width&&n===t.height||o({width:e,height:n})}const i=v.debounce(n,e),l=window.ResizeObserver||d;let c;return r?(c=new l(i),c.observe(r)):window.addEventListener("resize",i),n(),()=>{var e;window.removeEventListener("resize",i),null==(e=c)||e.disconnect()}},[t,o]),t}(),{scroll:i,onScroll:a}=m(),w=g(e=>e.scaleMultiplier),b=g(e=>e.pageReflow),C=g(e=>e.debug),{rootMargin:R,threshold:E,autoUpdate:T,wrapper:L}=s(()=>{const e={rootMargin:"0%",threshold:0,autoUpdate:!0},r=t||{};return Object.keys(r).map((t,o)=>{void 0!==r[t]&&(e[t]=r[t])}),e},[t]),{ref:j,inView:O}=u({rootMargin:R,threshold:E});f(()=>{j(e.current)},[e,null==e?void 0:e.current]);const[x,z]=c(h.vec3(0,0,0)),V=n({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,I=n({top:0,bottom:0,left:0,right:0,width:0,height:0}).current,[U,M]=c(I),k=n({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,P=n(h.vec3(0,0,0)).current;f(()=>{var t;const r=null==(t=e.current)?void 0:t.getBoundingClientRect();if(!r)return;const n=L?L.scrollTop:window.scrollY,i=L?L.scrollLeft:window.scrollX;I.top=r.top+n,I.bottom=r.bottom+n,I.left=r.left+i,I.right=r.right+i,I.width=r.width,I.height=r.height,M(p({},I)),z(h.vec3((null==I?void 0:I.width)*w,(null==I?void 0:I.height)*w,1)),C&&console.log("useTracker.getBoundingClientRect:",I,"intialScroll:",{initialY:n,initialX:i},"size:",o,"pageReflow:",b)},[e,o,b,w,C]);const B=l(({onlyUpdateInViewport:t=!1,scroll:r}={})=>{if(!e.current||t&&!V.inViewport)return;const n=r||i;!function(e,t,r,o){e.top=t.top-(r.y||0),e.bottom=t.bottom-(r.y||0),e.left=t.left-(r.x||0),e.right=t.right-(r.x||0),e.width=t.width,e.height=t.height,e.x=e.left+.5*t.width-.5*o.width,e.y=e.top+.5*t.height-.5*o.height,e.positiveYUpBottom=o.height-e.bottom}(k,I,n,o),function(e,t,r){e.x=t.x*r,e.y=-1*t.y*r}(P,k,w);const l="horizontal"===n.scrollDirection,c=l?"width":"height",s=o[c]-k[l?"left":"top"];V.progress=S(s,0,o[c]+k[c],0,1),V.visibility=S(s,0,k[c],0,1),V.viewport=S(s,0,o[c],0,1)},[e,o,w,i]);return f(()=>{V.inViewport=O,B({onlyUpdateInViewport:!1}),C&&console.log("useTracker.inViewport:",O,"update()")},[O]),f(()=>{B({onlyUpdateInViewport:!1}),C&&console.log("useTracker.update on resize/reflow")},[B,b]),r(()=>{if(T)return a(e=>B({onlyUpdateInViewport:!0}))},[T,B,a]),{rect:U,bounds:k,scale:x,position:P,scrollState:V,inViewport:O,update:B}}export{b as SmoothScrollbar,m as useScrollbar,C as useTracker};
//# sourceMappingURL=scrollbar.modern.js.map
