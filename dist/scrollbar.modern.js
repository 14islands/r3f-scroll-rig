import t from"zustand";import e,{useLayoutEffect as r,useEffect as o,forwardRef as n,useRef as i,useImperativeHandle as l,useCallback as c,useMemo as s,useState as a}from"react";import{addEffect as u,invalidate as d}from"@react-three/fiber";import h from"debounce";import p from"@studio-freight/lenis";import{useInView as v}from"react-intersection-observer";import w from"vecn";function f(){return f=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},f.apply(this,arguments)}function g(t,e){if(null==t)return{};var r,o,n={},i=Object.keys(t);for(o=0;o<i.length;o++)e.indexOf(r=i[o])>=0||(n[r]=t[r]);return n}function m(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}const b=t(t=>({debug:!1,scaleMultiplier:1,globalRender:!0,globalPriority:1e3,globalAutoClear:!1,globalClearDepth:!0,globalRenderQueue:!1,clearGlobalRenderQueue:()=>t(()=>({globalRenderQueue:!1})),isCanvasAvailable:!0,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(e,r,o={})=>t(({canvasChildren:t})=>Object.getOwnPropertyDescriptor(t,e)?(t[e].instances+=1,t[e].props.inactive=!1,{canvasChildren:t}):{canvasChildren:f({},t,{[e]:{mesh:r,props:o,instances:1}})}),updateCanvas:(e,r)=>t(({canvasChildren:t})=>{if(!t[e])return;const{[e]:{mesh:o,props:n,instances:i}}=t;return{canvasChildren:f({},t,{[e]:{mesh:o,props:f({},n,r),instances:i}})}}),removeFromCanvas:(e,r=!0)=>t(({canvasChildren:t})=>{var o;return(null==(o=t[e])?void 0:o.instances)>1?(t[e].instances-=1,{canvasChildren:t}):r?{canvasChildren:g(t,[e].map(m))}:(t[e].instances=0,t[e].props.inactive=!0,{canvasChildren:f({},t)})}),pageReflow:0,requestReflow:()=>{t(t=>({pageReflow:t.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:""},scrollTo:t=>window.scrollTo(0,t),onScroll:()=>()=>{}})),y=()=>({enabled:b(t=>t.hasSmoothScrollbar),scroll:b(t=>t.scroll),scrollTo:b(t=>t.scrollTo),onScroll:b(t=>t.onScroll)}),S="undefined"!=typeof window?r:o,C=["children","duration","easing","smooth","direction","config"],R=t=>1===t?1:1-Math.pow(2,-10*t);var E=n(function(t,e){let{children:r,duration:n=1,easing:c=R,smooth:s=!0,direction:a="vertical",config:u}=t,d=g(t,C);const h=i();return l(e,()=>({start:()=>{var t;return null==(t=h.current)?void 0:t.start()},stop:()=>{var t;return null==(t=h.current)?void 0:t.stop()},on:(t,e)=>{var r;return null==(r=h.current)?void 0:r.on(t,e)},once:(t,e)=>{var r;return null==(r=h.current)?void 0:r.once(t,e)},off:(t,e)=>{var r;return null==(r=h.current)?void 0:r.off(t,e)},notify:()=>{var t;return null==(t=h.current)?void 0:t.notify()},scrollTo:(t,e)=>{var r;return null==(r=h.current)?void 0:r.scrollTo(t,e)},raf:t=>{var e;return null==(e=h.current)?void 0:e.raf(t)}})),o(function(){const t=h.current=new p(f({duration:n,easing:c,smooth:s,direction:a},u));return()=>{t.destroy()}},[n,c,s,a]),r&&r(d)});const x=({children:t,enabled:r=!0,locked:n=!1,scrollRestoration:l="auto",disablePointerOnScroll:a=!0,horizontal:p=!1,scrollInContainer:v=!1,updateGlobalState:w=!0,onScroll:g,config:m})=>{const y=i(),C=i(),R=i(!1),x=b(t=>t.scroll),L=t=>{a&&y.current&&R.current!==t&&(R.current=t,y.current.style.pointerEvents=t?"none":"auto")},T=c(()=>{L(!1)},[]),O=c(t=>{var e;return null==(e=C.current)||e.on("scroll",t),()=>{var e;return null==(e=C.current)?void 0:e.off("scroll",t)}},[]);S(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=l)},[]),o(()=>{var t,e;const o=u(t=>{var e;return null==(e=C.current)?void 0:e.raf(t)});var n;null==(t=C.current)||t.on("scroll",({scroll:t,limit:e,velocity:r,direction:o,progress:n})=>{w&&(x.y="vertical"===o?t:0,x.x="horizontal"===o?t:0,x.limit=e,x.velocity=r,x.direction=o,x.progress=n);const i=h.debounce(()=>L(!0),100,!0);Math.abs(r)>1.4?i():L(!1),g&&g({scroll:t,limit:e,velocity:r,direction:o,progress:n}),d()}),null==(e=C.current)||e.notify(),w&&(b.setState({scrollTo:null==(n=C.current)?void 0:n.scrollTo}),b.setState({onScroll:O}),b.getState().scroll.y=window.scrollY,b.getState().scroll.x=window.scrollX),document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",r),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!r),b.setState({hasSmoothScrollbar:r});const i=()=>d();return window.addEventListener("pointermove",T),window.addEventListener("wheel",i),()=>{o(),window.removeEventListener("pointermove",T),window.removeEventListener("wheel",i)}},[r]),o(()=>{var t,e;n?null==(t=C.current)||t.stop():null==(e=C.current)||e.start()},[n]);const{wrapper:j,content:V}=s(()=>{if("undefined"==typeof document)return{};const t=document.documentElement,e=document.body,r=document.body.firstElementChild;return t.classList.toggle("ScrollRig-scrollHtml",v),e.classList.toggle("ScrollRig-scrollWrapper",v),{wrapper:e,content:r}},[v]);return e.createElement(E,{ref:C,smooth:r,direction:p?"horizontal":"vertical",config:f(v?{smoothTouch:!0,wrapper:j,content:V}:{},m)},e=>t(f({},e,{ref:y})))},L="undefined"!=typeof window;function T(t,e,r,o,n){return o+(t-e)*(n-o)/(r-e)}function O(t,e){const r=function(){const[t,e]=a({width:L?window.innerWidth:Infinity,height:L?window.innerHeight:Infinity});return o(()=>{const t=document.getElementById("ScrollRig-canvas");function r(){e({width:t?t.clientWidth:window.innerWidth,height:t?t.clientHeight:window.innerHeight})}const o=h.debounce(r,200);let n;return t?(n=new ResizeObserver(o),n.observe(t)):window.addEventListener("resize",o),r(),()=>{var t;window.removeEventListener("resize",o),null==(t=n)||t.disconnect()}},[]),t}(),{scroll:n,onScroll:l}=y(),u=b(t=>t.scaleMultiplier),d=b(t=>t.pageReflow),{rootMargin:p,threshold:g,autoUpdate:m,wrapper:C}=s(()=>{const t={rootMargin:"50%",threshold:0,autoUpdate:!0,wrapper:window},r=e||{};return Object.keys(r).map((e,o)=>{void 0!==r[e]&&(t[e]=r[e])}),t},[e]),{ref:R,inView:E}=v({rootMargin:p,threshold:g});S(()=>{R(t.current)},[t]);const[x,O]=a(),j=i({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,V=i({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0}).current,[z,I]=a(V),U=i({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,M=i(w.vec3(0,0,0)).current;S(()=>{var e;const r=null==(e=t.current)?void 0:e.getBoundingClientRect(),o=C===window?C.scrollY:C.scrollTop,n=C===window?C.scrollX:C.scrollLeft;V.top=r.top+o,V.bottom=r.bottom+o,V.left=r.left+n,V.right=r.right+n,V.width=r.width,V.height=r.height,V.x=V.left+.5*r.width,V.y=V.top+.5*r.height,I(f({},V)),O(w.vec3((null==V?void 0:V.width)*u,(null==V?void 0:V.height)*u,1))},[t,r,d,u]);const P=c(({onlyUpdateInViewport:e=!0,scroll:o=n}={})=>{if(!t.current||e&&!j.inViewport)return;!function(t,e,r,o){t.top=e.top-r.y,t.bottom=e.bottom-r.y,t.left=e.left-r.x,t.right=e.right-r.x,t.width=e.width,t.height=e.height,t.x=t.left+.5*e.width-.5*o.width,t.y=t.top+.5*e.height-.5*o.height,t.positiveYUpBottom=o.height-t.bottom}(U,V,o,r),function(t,e,r){t.x=e.x*r,t.y=-1*e.y*r}(M,U,u);const i="horizontal"===o.direction,l=i?"width":"height",c=r[l]-U[i?"left":"top"];j.progress=T(c,0,r[l]+U[l],0,1),j.visibility=T(c,0,U[l],0,1),j.viewport=T(c,0,r[l],0,1)},[t,r,u,n]);return S(()=>{j.inViewport=E,P({onlyUpdateInViewport:!1})},[E]),S(()=>{P({onlyUpdateInViewport:!1})},[P]),o(()=>{if(m)return l(t=>P())},[m,P,l]),{rect:z,bounds:U,scale:x,position:M,scrollState:j,inViewport:E,update:t=>P(f({onlyUpdateInViewport:!1},t))}}export{x as SmoothScrollbar,y as useScrollbar,O as useTracker};
//# sourceMappingURL=scrollbar.modern.js.map
