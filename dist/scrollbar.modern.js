import t from"zustand";import r,{useLayoutEffect as e,useEffect as o,forwardRef as n,useRef as i,useImperativeHandle as l,useCallback as c,useMemo as s,useState as a}from"react";import{addEffect as u,invalidate as d}from"@react-three/fiber";import h from"debounce";import v from"@studio-freight/lenis";import{useInView as p}from"react-intersection-observer";import f from"vecn";function w(){return w=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},w.apply(this,arguments)}function g(t,r){if(null==t)return{};var e,o,n={},i=Object.keys(t);for(o=0;o<i.length;o++)r.indexOf(e=i[o])>=0||(n[e]=t[e]);return n}function m(t){var r=function(t,r){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var o=e.call(t,"string");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof r?r:String(r)}const b=t(t=>({debug:!1,scaleMultiplier:1,globalRender:!0,globalPriority:1e3,globalAutoClear:!1,globalClearDepth:!0,globalRenderQueue:!1,clearGlobalRenderQueue:()=>t(()=>({globalRenderQueue:!1})),isCanvasAvailable:!0,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(r,e,o={})=>t(({canvasChildren:t})=>Object.getOwnPropertyDescriptor(t,r)?(t[r].instances+=1,t[r].props.inactive=!1,{canvasChildren:t}):{canvasChildren:w({},t,{[r]:{mesh:e,props:o,instances:1}})}),updateCanvas:(r,e)=>t(({canvasChildren:t})=>{if(!t[r])return;const{[r]:{mesh:o,props:n,instances:i}}=t;return{canvasChildren:w({},t,{[r]:{mesh:o,props:w({},n,e),instances:i}})}}),removeFromCanvas:(r,e=!0)=>t(({canvasChildren:t})=>{var o;return(null==(o=t[r])?void 0:o.instances)>1?(t[r].instances-=1,{canvasChildren:t}):e?{canvasChildren:g(t,[r].map(m))}:(t[r].instances=0,t[r].props.inactive=!0,{canvasChildren:w({},t)})}),pageReflow:0,requestReflow:()=>{t(t=>({pageReflow:t.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},scrollTo:t=>window.scrollTo(0,t),onScroll:()=>()=>{}})),y=()=>({enabled:b(t=>t.hasSmoothScrollbar),scroll:b(t=>t.scroll),scrollTo:b(t=>t.scrollTo),onScroll:b(t=>t.onScroll)}),S="undefined"!=typeof window?e:o,C=["children","duration","easing","smooth","direction","config"],R=t=>1===t?1:1-Math.pow(2,-10*t);var E=n(function(t,r){let{children:e,duration:n=1,easing:c=R,smooth:s=!0,direction:a="vertical",config:u}=t,d=g(t,C);const h=i();return l(r,()=>({start:()=>{var t;return null==(t=h.current)?void 0:t.start()},stop:()=>{var t;return null==(t=h.current)?void 0:t.stop()},on:(t,r)=>{var e;return null==(e=h.current)?void 0:e.on(t,r)},once:(t,r)=>{var e;return null==(e=h.current)?void 0:e.once(t,r)},off:(t,r)=>{var e;return null==(e=h.current)?void 0:e.off(t,r)},notify:()=>{var t;return null==(t=h.current)?void 0:t.notify()},scrollTo:(t,r)=>{var e;return null==(e=h.current)?void 0:e.scrollTo(t,r)},raf:t=>{var r;return null==(r=h.current)?void 0:r.raf(t)},__lenis:h.current})),o(function(){const t=h.current=new v(w({duration:n,easing:c,smooth:s,direction:a},u));return()=>{t.destroy()}},[n,c,s,a]),e&&e(d)});const T=n(({children:t,enabled:e=!0,locked:n=!1,scrollRestoration:a="auto",disablePointerOnScroll:v=!0,horizontal:p=!1,scrollInContainer:f=!1,updateGlobalState:g=!0,onScroll:m,config:y},C)=>{const R=i(),T=i(),x=i(!1),L=b(t=>t.scroll);l(C,()=>({scrollTo:(t,r)=>{var e;return null==(e=T.current)?void 0:e.scrollTo(t,r)},__lenis:T.current}));const O=t=>{v&&R.current&&x.current!==t&&(x.current=t,R.current.style.pointerEvents=t?"none":"auto")},j=c(()=>{O(!1)},[]),V=c(t=>{var r;return null==(r=T.current)||r.on("scroll",t),()=>{var r;return null==(r=T.current)?void 0:r.off("scroll",t)}},[]);S(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=a)},[]),o(()=>{var t,r;const e=u(t=>{var r;return null==(r=T.current)?void 0:r.raf(t)});var o;null==(t=T.current)||t.on("scroll",({scroll:t,limit:r,velocity:e,direction:o,progress:n})=>{const i=p?t:0;g&&(L.y=p?0:t,L.x=i,L.limit=r,L.velocity=e,L.direction=o,L.progress=n);const l=h.debounce(()=>O(!0),100,!0);Math.abs(e)>1.4?l():O(!1),m&&m({scroll:t,limit:r,velocity:e,direction:o,progress:n}),d()}),null==(r=T.current)||r.notify(),g&&(L.scrollDirection=p?"horizontal":"vertical",b.setState({scrollTo:null==(o=T.current)?void 0:o.scrollTo}),b.setState({onScroll:V}),b.getState().scroll.y=window.scrollY,b.getState().scroll.x=window.scrollX);const n=()=>d();return window.addEventListener("pointermove",j),window.addEventListener("wheel",n),()=>{var t;null==(t=T.current)||t.off("scroll"),e(),window.removeEventListener("pointermove",j),window.removeEventListener("wheel",n)}},[]),o(()=>{g&&(document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",e),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!e),b.setState({hasSmoothScrollbar:e}))},[e]),o(()=>{var t,r;n?null==(t=T.current)||t.stop():null==(r=T.current)||r.start()},[n]);const{wrapper:z,content:I}=s(()=>{if("undefined"==typeof document)return{};const t=document.documentElement,r=document.body,e=document.body.firstElementChild;return t.classList.toggle("ScrollRig-scrollHtml",f),r.classList.toggle("ScrollRig-scrollWrapper",f),{wrapper:r,content:e}},[f]);return r.createElement(E,{ref:T,direction:p?"horizontal":"vertical",config:w(f?{smoothTouch:!0,wrapper:z,content:I}:{},y)},r=>t(w({},r,{ref:R})))}),x="undefined"!=typeof window;function L(t,r,e,o,n){return o+(t-r)*(n-o)/(e-r)}function O(t,r){const e=function({debounce:t=0}={}){const[r,e]=a({width:x?window.innerWidth:Infinity,height:x?window.innerHeight:Infinity});return o(()=>{const o=document.getElementById("ScrollRig-canvas");function n(){const t=o?o.clientWidth:window.innerWidth,n=o?o.clientHeight:window.innerHeight;t===r.width&&n===r.height||e({width:t,height:n})}const i=h.debounce(n,t);let l;return o?(l=new ResizeObserver(i),l.observe(o)):window.addEventListener("resize",i),n(),()=>{var t;window.removeEventListener("resize",i),null==(t=l)||t.disconnect()}},[]),r}(),{scroll:n,onScroll:l}=y(),u=b(t=>t.scaleMultiplier),d=b(t=>t.pageReflow),{rootMargin:v,threshold:g,autoUpdate:m,wrapper:C}=s(()=>{const t={rootMargin:"0%",threshold:0,autoUpdate:!0},e=r||{};return Object.keys(e).map((r,o)=>{void 0!==e[r]&&(t[r]=e[r])}),t},[r]),{ref:R,inView:E}=p({rootMargin:v,threshold:g});S(()=>{R(t.current)},[t]);const[T,O]=a(),j=i({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,V=i({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0}).current,[z,I]=a(V),U=i({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,M=i(f.vec3(0,0,0)).current;S(()=>{var r;const e=null==(r=t.current)?void 0:r.getBoundingClientRect();if(!e)return;const o=C?C.scrollTop:window.scrollY,n=C?C.scrollLeft:window.scrollX;V.top=e.top+o,V.bottom=e.bottom+o,V.left=e.left+n,V.right=e.right+n,V.width=e.width,V.height=e.height,V.x=V.left+.5*e.width,V.y=V.top+.5*e.height,I(w({},V)),O(f.vec3((null==V?void 0:V.width)*u,(null==V?void 0:V.height)*u,1))},[t,e,d,u]);const P=c(({onlyUpdateInViewport:r=!1,scroll:o}={})=>{if(!t.current||r&&!j.inViewport)return;const i=o||n;!function(t,r,e,o){t.top=r.top-e.y,t.bottom=r.bottom-e.y,t.left=r.left-e.x,t.right=r.right-e.x,t.width=r.width,t.height=r.height,t.x=t.left+.5*r.width-.5*o.width,t.y=t.top+.5*r.height-.5*o.height,t.positiveYUpBottom=o.height-t.bottom}(U,V,i,e),function(t,r,e){t.x=r.x*e,t.y=-1*r.y*e}(M,U,u);const l="horizontal"===i.scrollDirection,c=l?"width":"height",s=e[c]-U[l?"left":"top"];j.progress=L(s,0,e[c]+U[c],0,1),j.visibility=L(s,0,U[c],0,1),j.viewport=L(s,0,e[c],0,1)},[t,e,u,n]);return S(()=>{j.inViewport=E,P({onlyUpdateInViewport:!1})},[E]),S(()=>{P({onlyUpdateInViewport:!1})},[P]),o(()=>{if(m)return l(t=>P({onlyUpdateInViewport:!0}))},[m,P,l]),{rect:z,bounds:U,scale:T,position:M,scrollState:j,inViewport:E,update:P}}export{T as SmoothScrollbar,y as useScrollbar,O as useTracker};
//# sourceMappingURL=scrollbar.modern.js.map
