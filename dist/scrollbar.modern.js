import t from"zustand";import e,{useLayoutEffect as o,useEffect as r,forwardRef as n,useRef as i,useImperativeHandle as l,useCallback as c,useMemo as s,useState as a}from"react";import{addEffect as d,invalidate as u}from"@react-three/fiber";import h from"debounce";import p from"@studio-freight/lenis";import{useInView as v}from"react-intersection-observer";import w from"vecn";function g(){return g=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},g.apply(this,arguments)}function f(t,e){if(null==t)return{};var o,r,n={},i=Object.keys(t);for(r=0;r<i.length;r++)e.indexOf(o=i[r])>=0||(n[o]=t[o]);return n}function m(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var r=o.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}const b=t(t=>({debug:!1,scaleMultiplier:1,globalRender:!0,globalPriority:1e3,globalAutoClear:!1,globalClearDepth:!0,globalRenderQueue:!1,clearGlobalRenderQueue:()=>t(()=>({globalRenderQueue:!1})),isCanvasAvailable:!0,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(e,o,r={})=>t(({canvasChildren:t})=>Object.getOwnPropertyDescriptor(t,e)?(t[e].instances+=1,t[e].props.inactive=!1,{canvasChildren:t}):{canvasChildren:g({},t,{[e]:{mesh:o,props:r,instances:1}})}),updateCanvas:(e,o)=>t(({canvasChildren:t})=>{if(!t[e])return;const{[e]:{mesh:r,props:n,instances:i}}=t;return{canvasChildren:g({},t,{[e]:{mesh:r,props:g({},n,o),instances:i}})}}),removeFromCanvas:(e,o=!0)=>t(({canvasChildren:t})=>{var r;return(null==(r=t[e])?void 0:r.instances)>1?(t[e].instances-=1,{canvasChildren:t}):o?{canvasChildren:f(t,[e].map(m))}:(t[e].instances=0,t[e].props.inactive=!0,{canvasChildren:g({},t)})}),pageReflow:0,requestReflow:()=>{t(t=>({pageReflow:t.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},scrollTo:t=>window.scrollTo(0,t),onScroll:()=>()=>{}})),y=()=>({enabled:b(t=>t.hasSmoothScrollbar),scroll:b(t=>t.scroll),scrollTo:b(t=>t.scrollTo),onScroll:b(t=>t.onScroll)}),S="undefined"!=typeof window?o:r,C=["children","duration","easing","smooth","direction","config"],R=t=>1===t?1:1-Math.pow(2,-10*t);var E=n(function(t,e){let{children:o,duration:n=1,easing:c=R,smooth:s=!0,direction:a="vertical",config:d}=t,u=f(t,C);const h=i();return l(e,()=>h.current),r(function(){const t=h.current=new p(g({duration:n,easing:c,smooth:s,direction:a},d));return()=>{t.destroy()}},[n,c,s,a]),o&&o(u)});const x=n(({children:t,enabled:o=!0,locked:n=!1,scrollRestoration:a="auto",disablePointerOnScroll:p=!0,horizontal:v=!1,scrollInContainer:w=!1,updateGlobalState:f=!0,onScroll:m,config:y},C)=>{const R=i(),x=i(),L=i(!1),T=b(t=>t.scroll);l(C,()=>({scrollTo:(t,e)=>{var o;return null==(o=x.current)?void 0:o.scrollTo(t,e)},__lenis:x.current}));const O=t=>{p&&R.current&&L.current!==t&&(L.current=t,R.current.style.pointerEvents=t?"none":"auto")},j=c(()=>{O(!1)},[]),V=c(t=>{var e;return null==(e=x.current)||e.on("scroll",t),()=>{var e;return null==(e=x.current)?void 0:e.off("scroll",t)}},[]);S(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=a)},[]),r(()=>{var t,e;const r=d(t=>{var e;return null==(e=x.current)?void 0:e.raf(t)});var n;null==(t=x.current)||t.on("scroll",({scroll:t,limit:e,velocity:o,direction:r,progress:n})=>{f&&(T.y=v?0:t,T.x=v?t:0,T.limit=e,T.velocity=o,T.direction=r,T.progress=n);const i=h.debounce(()=>O(!0),100,!0);Math.abs(o)>1.4?i():O(!1),m&&m({scroll:t,limit:e,velocity:o,direction:r,progress:n}),u()}),null==(e=x.current)||e.notify(),f&&(T.scrollDirection=v?"horizontal":"vertical",b.setState({scrollTo:null==(n=x.current)?void 0:n.scrollTo}),b.setState({onScroll:V}),b.getState().scroll.y=window.scrollY,b.getState().scroll.x=window.scrollX),document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",o),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!o),b.setState({hasSmoothScrollbar:o});const i=()=>u();return window.addEventListener("pointermove",j),window.addEventListener("wheel",i),()=>{r(),window.removeEventListener("pointermove",j),window.removeEventListener("wheel",i)}},[o]),r(()=>{var t,e;n?null==(t=x.current)||t.stop():null==(e=x.current)||e.start()},[n]);const{wrapper:z,content:I}=s(()=>{if("undefined"==typeof document)return{};const t=document.documentElement,e=document.body,o=document.body.firstElementChild;return t.classList.toggle("ScrollRig-scrollHtml",w),e.classList.toggle("ScrollRig-scrollWrapper",w),{wrapper:e,content:o}},[w]);return e.createElement(E,{ref:x,smooth:o,direction:v?"horizontal":"vertical",config:g(w?{smoothTouch:!0,wrapper:z,content:I}:{},y)},e=>t(g({},e,{ref:R})))}),L="undefined"!=typeof window;function T(t,e,o,r,n){return r+(t-e)*(n-r)/(o-e)}function O(t,e){const o=function({debounce:t=0}={}){const[e,o]=a({width:L?window.innerWidth:Infinity,height:L?window.innerHeight:Infinity});return r(()=>{const r=document.getElementById("ScrollRig-canvas");function n(){const t=r?r.clientWidth:window.innerWidth,n=r?r.clientHeight:window.innerHeight;t===e.width&&n===e.height||o({width:t,height:n})}const i=h.debounce(n,t);let l;return r?(l=new ResizeObserver(i),l.observe(r)):window.addEventListener("resize",i),n(),()=>{var t;window.removeEventListener("resize",i),null==(t=l)||t.disconnect()}},[]),e}(),{scroll:n,onScroll:l}=y(),d=b(t=>t.scaleMultiplier),u=b(t=>t.pageReflow),{rootMargin:p,threshold:f,autoUpdate:m,wrapper:C}=s(()=>{const t={rootMargin:"0%",threshold:0,autoUpdate:!0},o=e||{};return Object.keys(o).map((e,r)=>{void 0!==o[e]&&(t[e]=o[e])}),t},[e]),{ref:R,inView:E}=v({rootMargin:p,threshold:f});S(()=>{R(t.current)},[t]);const[x,O]=a(),j=i({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,V=i({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0}).current,[z,I]=a(V),U=i({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,M=i(w.vec3(0,0,0)).current;S(()=>{var e;const o=null==(e=t.current)?void 0:e.getBoundingClientRect();if(!o)return;const r=C?C.scrollTop:window.scrollY,n=C?C.scrollLeft:window.scrollX;V.top=o.top+r,V.bottom=o.bottom+r,V.left=o.left+n,V.right=o.right+n,V.width=o.width,V.height=o.height,V.x=V.left+.5*o.width,V.y=V.top+.5*o.height,I(g({},V)),O(w.vec3((null==V?void 0:V.width)*d,(null==V?void 0:V.height)*d,1))},[t,o,u,d]);const P=c(({onlyUpdateInViewport:e=!0,scroll:r=n}={})=>{if(!t.current||e&&!j.inViewport)return;!function(t,e,o,r){t.top=e.top-o.y,t.bottom=e.bottom-o.y,t.left=e.left-o.x,t.right=e.right-o.x,t.width=e.width,t.height=e.height,t.x=t.left+.5*e.width-.5*r.width,t.y=t.top+.5*e.height-.5*r.height,t.positiveYUpBottom=r.height-t.bottom}(U,V,r,o),function(t,e,o){t.x=e.x*o,t.y=-1*e.y*o}(M,U,d);const i="horizontal"===r.scrollDirection,l=i?"width":"height",c=o[l]-U[i?"left":"top"];j.progress=T(c,0,o[l]+U[l],0,1),j.visibility=T(c,0,U[l],0,1),j.viewport=T(c,0,o[l],0,1)},[t,o,d,n]);return S(()=>{j.inViewport=E,P({onlyUpdateInViewport:!1})},[E]),S(()=>{P({onlyUpdateInViewport:!1})},[P]),r(()=>{if(m)return l(t=>P())},[m,P,l]),{rect:z,bounds:U,scale:x,position:M,scrollState:j,inViewport:E,update:t=>P(g({onlyUpdateInViewport:!1},t))}}export{x as SmoothScrollbar,y as useScrollbar,O as useTracker};
//# sourceMappingURL=scrollbar.modern.js.map
